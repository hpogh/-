<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ - BakeryManager</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="brand">
                <div class="logo" style="background: linear-gradient(135deg, #10b981, #059669);">‚öôÔ∏è</div>
                <div>
                    <h1 class="site-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h1>
                    <div class="site-subtitle">–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ BakeryManager</h2>
            <p style="margin-bottom: 2rem;">–°–ª–µ–¥—É–π—Ç–µ —à–∞–≥–∞–º –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</p>
            
            <div id="setup-steps">
                <!-- Step 1: Firebase Connection -->
                <div class="setup-step active" id="step-1">
                    <h3><i class="fas fa-plug"></i> –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase</h3>
                    <div class="form-group">
                        <label class="form-label">URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Firebase</label>
                        <input type="text" class="form-control" id="firebase-url" 
                               value="https://ekzamen-kuznetsov-default-rtdb.europe-west1.firebasedatabase.app/" 
                               readonly>
                    </div>
                    <button class="btn btn-primary" onclick="testFirebaseConnection()">
                        <i class="fas fa-wifi"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                    </button>
                    <div id="connection-result" style="margin-top: 1rem;"></div>
                </div>
                
                <!-- Step 2: Create Admin User -->
                <div class="setup-step" id="step-2" style="display: none;">
                    <h3><i class="fas fa-user-shield"></i> –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firebase Console, –∑–∞—Ç–µ–º —É–∫–∞–∂–∏—Ç–µ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ:</p>
                    
                    <form id="admin-form" onsubmit="createAdminUser(event)">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label">–ò–º—è</label>
                                <input type="text" class="form-control" id="admin-first-name" 
                                       value="–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
                                <input type="text" class="form-control" id="admin-last-name" 
                                       value="–°–∏—Å—Ç–µ–º—ã" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                            <input type="email" class="form-control" id="admin-email" 
                                   value="admin@webbakery.com" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">UID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Firebase Console</label>
                            <input type="text" class="form-control" id="admin-uid" 
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ UID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
                            <small style="display: block; margin-top: 0.5rem; color: var(--text-light);">
                                UID –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ Firebase Console ‚Üí Authentication ‚Üí Users
                            </small>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-user-plus"></i> –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="goToStep(3)">
                                –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Step 3: Test Data -->
                <div class="setup-step" id="step-3" style="display: none;">
                    <h3><i class="fas fa-database"></i> –®–∞–≥ 3: –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    <p>–°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã?</p>
                    
                    <div id="test-data-result" style="margin: 1rem 0;"></div>
                    
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="createTestData()">
                            <i class="fas fa-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                        </button>
                        <button class="btn btn-secondary" onclick="goToStep(4)">
                            –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <!-- Step 4: Complete -->
                <div class="setup-step" id="step-4" style="display: none;">
                    <div style="text-align: center; padding: 3rem 0;">
                        <div style="width: 80px; height: 80px; background: var(--success); color: white; 
                             border-radius: 50%; display: flex; align-items: center; justify-content: center; 
                             font-size: 2rem; margin: 0 auto 2rem;">
                            <i class="fas fa-check"></i>
                        </div>
                        
                        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ</h2>
                        <p style="margin: 1rem 0 2rem; font-size: 1.125rem;">
                            –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
                        </p>
                        
                        <div class="form-actions" style="justify-content: center;">
                            <button class="btn btn-primary" onclick="location.href='/auth.html'">
                                <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                            </button>
                            <button class="btn btn-secondary" onclick="location.href='/index.html'">
                                <i class="fas fa-home"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="setup-progress" style="margin-top: 3rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    <span id="progress-percent">25%</span>
                </div>
                <div style="height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                    <div id="progress-bar" style="height: 100%; background: var(--primary); width: 25%; 
                         transition: width 0.3s;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.875rem;">
                    <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</span>
                    <span>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                    <span>–î–∞–Ω–Ω—ã–µ</span>
                    <span>–ì–æ—Ç–æ–≤–æ</span>
                </div>
            </div>
        </div>
    </main>

    <div class="toast-container" id="toast-container"></div>

    <script type="module">
        import { 
            db, ref, set, get, 
            getDatabase, initializeApp 
        } from './assets/js/firebase-config.js';

        // Show toast message
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            container.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }

        // Show message in step
        function showStepMessage(stepId, message, type = 'info') {
            const step = document.getElementById(stepId);
            const messageDiv = step.querySelector('.step-message') || document.createElement('div');
            messageDiv.className = 'step-message';
            messageDiv.style.cssText = `
                padding: 1rem;
                border-radius: var(--radius);
                background: ${type === 'success' ? '#d1fae5' : 
                           type === 'error' ? '#fee2e2' : 
                           '#e0f2fe'};
                color: ${type === 'success' ? '#065f46' : 
                        type === 'error' ? '#991b1b' : 
                        '#0369a1'};
                margin: 1rem 0;
            `;
            messageDiv.innerHTML = message;
            
            if (!step.querySelector('.step-message')) {
                step.appendChild(messageDiv);
            }
        }

        // Update progress bar
        function updateProgress(percent) {
            document.getElementById('progress-bar').style.width = `${percent}%`;
            document.getElementById('progress-percent').textContent = `${percent}%`;
        }

        // Go to specific step
        function goToStep(stepNumber) {
            // Hide all steps
            document.querySelectorAll('.setup-step').forEach(step => {
                step.style.display = 'none';
                step.classList.remove('active');
            });
            
            // Show target step
            const targetStep = document.getElementById(`step-${stepNumber}`);
            targetStep.style.display = 'block';
            targetStep.classList.add('active');
            
            // Update progress
            const progressMap = {1: 25, 2: 50, 3: 75, 4: 100};
            updateProgress(progressMap[stepNumber]);
        }

        // Test Firebase connection
        async function testFirebaseConnection() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = '<div style="color: var(--text-light);"><i class="fas fa-spinner fa-spin"></i> –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</div>';
            
            try {
                // Test connection by trying to read from root
                const rootRef = ref(db, '/');
                const snapshot = await get(rootRef);
                
                if (snapshot.exists()) {
                    resultDiv.innerHTML = `
                        <div style="color: var(--success);">
                            <i class="fas fa-check-circle"></i> –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase!
                            <div style="font-size: 0.875rem; margin-top: 0.5rem; color: var(--text-light);">
                                –í–µ—Ä—Å–∏—è –¥–∞–Ω–Ω—ã—Ö: ${snapshot.val()?.__version__ || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}
                            </div>
                        </div>
                    `;
                    showToast('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                    
                    // Auto-proceed to next step after 1 second
                    setTimeout(() => goToStep(2), 1000);
                } else {
                    resultDiv.innerHTML = `
                        <div style="color: var(--warning);">
                            <i class="fas fa-exclamation-triangle"></i> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –Ω–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞
                        </div>
                    `;
                    showToast('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É', 'warning');
                    setTimeout(() => goToStep(2), 1000);
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="color: var(--danger);">
                        <i class="fas fa-times-circle"></i> –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}
                        <div style="font-size: 0.875rem; margin-top: 0.5rem;">
                            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Firebase –≤ firebase-config.js
                        </div>
                    </div>
                `;
                showToast(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        // Create admin user
        async function createAdminUser(e) {
            e.preventDefault();
            
            const firstName = document.getElementById('admin-first-name').value;
            const lastName = document.getElementById('admin-last-name').value;
            const email = document.getElementById('admin-email').value;
            const uid = document.getElementById('admin-uid').value.trim();
            
            if (!uid) {
                showStepMessage('step-2', '–í–≤–µ–¥–∏—Ç–µ UID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Firebase Console', 'error');
                return;
            }
            
            try {
                // Create authorization record
                const authRef = ref(db, `authorization/${uid}`);
                await set(authRef, {
                    email: email,
                    role: 'admin',
                    created_at: new Date().toISOString(),
                    is_super_admin: true
                });
                
                // Create employee record
                const employeeRef = ref(db, `employees/${uid}`);
                await set(employeeRef, {
                    auth_id: uid,
                    first_name: firstName,
                    last_name: lastName,
                    email: email,
                    phone: '+79991234567',
                    position: '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                    hire_date: new Date().toISOString().split('T')[0],
                    status: 'active',
                    is_admin: true
                });
                
                // Create admin settings
                const settingsRef = ref(db, `settings/admin_users/${uid}`);
                await set(settingsRef, {
                    email: email,
                    permissions: ['all'],
                    created_at: new Date().toISOString()
                });
                
                showStepMessage('step-2', `
                    <strong>‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!</strong>
                    <div style="margin-top: 0.5rem;">
                        <strong>–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:</strong><br>
                        Email: ${email}<br>
                        –ü–∞—Ä–æ–ª—å: (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Firebase Console)
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.875rem;">
                        <i class="fas fa-info-circle"></i> –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                    </div>
                `, 'success');
                
                showToast('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω', 'success');
                
                // Auto-proceed after 2 seconds
                setTimeout(() => goToStep(3), 2000);
                
            } catch (error) {
                showStepMessage('step-2', `–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: ${error.message}`, 'error');
                showToast(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // Create test data
        async function createTestData() {
            const resultDiv = document.getElementById('test-data-result');
            resultDiv.innerHTML = '<div style="color: var(--text-light);"><i class="fas fa-spinner fa-spin"></i> –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...</div>';
            
            try {
                // Test bakery products
                const bakeryRef = ref(db, 'products/bakery');
                await set(bakeryRef, {
                    product_001: {
                        name: "–ö—Ä—É–∞—Å—Å–∞–Ω —à–æ–∫–æ–ª–∞–¥–Ω—ã–π",
                        category: "–≤—ã–ø–µ—á–∫–∞",
                        subcategory: "—Å–¥–æ–±–∞",
                        description: "–°–≤–µ–∂–∏–π –∫—Ä—É–∞—Å—Å–∞–Ω —Å –Ω–∞—á–∏–Ω–∫–æ–π –∏–∑ –±–µ–ª—å–≥–∏–π—Å–∫–æ–≥–æ —à–æ–∫–æ–ª–∞–¥–∞",
                        price: 120,
                        unit: "—à—Ç",
                        in_stock: true,
                        quantity: 50,
                        supplier_id: "supplier_001",
                        image_url: "",
                        created_at: new Date().toISOString(),
                        popularity: 95
                    },
                    product_002: {
                        name: "–ë–∞–≥–µ—Ç —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π",
                        category: "–≤—ã–ø–µ—á–∫–∞",
                        subcategory: "—Ö–ª–µ–±",
                        description: "–•—Ä—É—Å—Ç—è—â–∏–π –±–∞–≥–µ—Ç –ø–æ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–º—É —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–º—É —Ä–µ—Ü–µ–ø—Ç—É",
                        price: 80,
                        unit: "—à—Ç",
                        in_stock: true,
                        quantity: 30,
                        supplier_id: "supplier_001",
                        image_url: "",
                        created_at: new Date().toISOString(),
                        popularity: 88
                    },
                    product_003: {
                        name: "–ß–∏–∑–∫–µ–π–∫ –ù—å—é-–ô–æ—Ä–∫",
                        category: "–≤—ã–ø–µ—á–∫–∞",
                        subcategory: "–ø–∏—Ä–æ–∂–Ω—ã–µ",
                        description: "–ù–µ–∂–Ω—ã–π —á–∏–∑–∫–µ–π–∫ —Å —Ç–≤–æ—Ä–æ–∂–Ω—ã–º –∫—Ä–µ–º–æ–º –∏ —è–≥–æ–¥–Ω—ã–º —Å–æ—É—Å–æ–º",
                        price: 250,
                        unit: "—à—Ç",
                        in_stock: true,
                        quantity: 15,
                        supplier_id: "supplier_001",
                        image_url: "",
                        created_at: new Date().toISOString(),
                        popularity: 92
                    }
                });
                
                // Test drinks
                const drinksRef = ref(db, 'products/drinks');
                await set(drinksRef, {
                    product_101: {
                        name: "–ö–∞–ø—É—á–∏–Ω–æ",
                        category: "–Ω–∞–ø–∏—Ç–∫–∏",
                        subcategory: "–∫–æ—Ñ–µ",
                        description: "–ö–æ—Ñ–µ —Å –º–æ–ª–æ—á–Ω–æ–π –ø–µ–Ω–∫–æ–π –∏ —Ä–∏—Å—É–Ω–∫–æ–º –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏",
                        price: 200,
                        size: "300 –º–ª",
                        in_stock: true,
                        quantity: 100,
                        supplier_id: "supplier_002",
                        image_url: "",
                        created_at: new Date().toISOString(),
                        popularity: 96
                    },
                    product_102: {
                        name: "–≠—Å–ø—Ä–µ—Å—Å–æ",
                        category: "–Ω–∞–ø–∏—Ç–∫–∏",
                        subcategory: "–∫–æ—Ñ–µ",
                        description: "–ö—Ä–µ–ø–∫–∏–π —á–µ—Ä–Ω—ã–π –∫–æ—Ñ–µ –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–∏—Ö —Ü–µ–Ω–∏—Ç–µ–ª–µ–π",
                        price: 150,
                        size: "50 –º–ª",
                        in_stock: true,
                        quantity: 80,
                        supplier_id: "supplier_002",
                        image_url: "",
                        created_at: new Date().toISOString(),
                        popularity: 85
                    },
                    product_103: {
                        name: "–õ–∞—Ç—Ç–µ",
                        category: "–Ω–∞–ø–∏—Ç–∫–∏",
                        subcategory: "–∫–æ—Ñ–µ",
                        description: "–ù–µ–∂–Ω—ã–π –∫–æ—Ñ–µ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –º–æ–ª–æ–∫–∞",
                        price: 220,
                        size: "400 –º–ª",
                        in_stock: true,
                        quantity: 60,
                        supplier_id: "supplier_002",
                        image_url: "",
                        created_at: new Date().toISOString(),
                        popularity: 90
                    }
                });
                
                // Test suppliers
                const suppliersRef = ref(db, 'suppliers');
                await set(suppliersRef, {
                    supplier_001: {
                        name: "–ü–µ–∫–∞—Ä–Ω—è '–£—Ç—Ä–æ'",
                        type: "–≤—ã–ø–µ—á–∫–∞",
                        contact_person: "–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞",
                        phone: "+79997654321",
                        email: "supplier@utro.ru",
                        address: "–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü–µ–∫–æ–≤–∞—è, 10",
                        delivery_days: ["–ø–Ω", "—Å—Ä", "–ø—Ç"],
                        status: "active",
                        rating: 4.8,
                        contract_start: "2024-01-01"
                    },
                    supplier_002: {
                        name: "–ö–æ—Ñ–µ–π–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è '–ê—Ä–∞–±–∏–∫–∞'",
                        type: "–Ω–∞–ø–∏—Ç–∫–∏",
                        contact_person: "–ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ–≤",
                        phone: "+79998887766",
                        email: "coffee@arabica.ru",
                        address: "–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ö–æ—Ñ–µ–π–Ω–∞—è, 5",
                        delivery_days: ["–≤—Ç", "—á—Ç"],
                        status: "active",
                        rating: 4.9,
                        contract_start: "2024-01-15"
                    }
                });
                
                // Test employees (if not admin already created)
                const employeesRef = ref(db, 'employees');
                const employeesSnap = await get(employeesRef);
                
                if (!employeesSnap.exists() || Object.keys(employeesSnap.val()).length <= 1) {
                    await set(ref(db, 'employees/emp_001'), {
                        auth_id: "",
                        first_name: "–ò–≤–∞–Ω",
                        last_name: "–ü–µ—Ç—Ä–æ–≤",
                        email: "ivan@webbakery.com",
                        phone: "+79991112233",
                        position: "–ø–µ–∫–∞—Ä—å",
                        hire_date: "2024-01-15",
                        status: "active",
                        salary: 45000
                    });
                    
                    await set(ref(db, 'employees/emp_002'), {
                        auth_id: "",
                        first_name: "–ú–∞—Ä–∏—è",
                        last_name: "–°–∏–¥–æ—Ä–æ–≤–∞",
                        email: "maria@webbakery.com",
                        phone: "+79992223344",
                        position: "–ø—Ä–æ–¥–∞–≤–µ—Ü",
                        hire_date: "2024-02-01",
                        status: "active",
                        salary: 38000
                    });
                }
                
                // Create test orders
                const ordersRef = ref(db, 'orders');
                await set(ordersRef, {
                    order_001: {
                        order_id: "ORD-2024-001",
                        customer_name: "–ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞",
                        customer_phone: "+79993334455",
                        order_date: new Date().toISOString(),
                        status: "completed",
                        total_amount: 540,
                        employee_id: "emp_002",
                        items: {
                            item_1: {
                                product_id: "product_001",
                                name: "–ö—Ä—É–∞—Å—Å–∞–Ω —à–æ–∫–æ–ª–∞–¥–Ω—ã–π",
                                quantity: 2,
                                price: 120
                            },
                            item_2: {
                                product_id: "product_101",
                                name: "–ö–∞–ø—É—á–∏–Ω–æ",
                                quantity: 3,
                                price: 200
                            }
                        }
                    },
                    order_002: {
                        order_id: "ORD-2024-002",
                        customer_name: "–î–º–∏—Ç—Ä–∏–π –ò–≤–∞–Ω–æ–≤",
                        customer_phone: "+79994445566",
                        order_date: new Date(Date.now() - 86400000).toISOString(), // yesterday
                        status: "preparing",
                        total_amount: 850,
                        employee_id: "emp_002",
                        items: {
                            item_1: {
                                product_id: "product_003",
                                name: "–ß–∏–∑–∫–µ–π–∫ –ù—å—é-–ô–æ—Ä–∫",
                                quantity: 1,
                                price: 250
                            },
                            item_2: {
                                product_id: "product_102",
                                name: "–≠—Å–ø—Ä–µ—Å—Å–æ",
                                quantity: 4,
                                price: 150
                            }
                        }
                    }
                });
                
                // Create system settings
                const systemSettingsRef = ref(db, 'settings/system');
                await set(systemSettingsRef, {
                    bakery_name: "Web Bakery",
                    currency: "RUB",
                    tax_rate: 20,
                    opening_time: "08:00",
                    closing_time: "20:00",
                    setup_completed: true,
                    setup_date: new Date().toISOString(),
                    version: "1.0.0"
                });
                
                resultDiv.innerHTML = `
                    <div style="color: var(--success);">
                        <i class="fas fa-check-circle"></i> –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!
                        <div style="font-size: 0.875rem; margin-top: 0.5rem;">
                            <strong>–°–æ–∑–¥–∞–Ω–æ:</strong><br>
                            ‚Ä¢ 3 –≤–∏–¥–∞ –≤—ã–ø–µ—á–∫–∏<br>
                            ‚Ä¢ 3 –≤–∏–¥–∞ –Ω–∞–ø–∏—Ç–∫–æ–≤<br>
                            ‚Ä¢ 2 –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞<br>
                            ‚Ä¢ 2 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞<br>
                            ‚Ä¢ 2 –∑–∞–∫–∞–∑–∞<br>
                            ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
                        </div>
                    </div>
                `;
                
                showToast('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã', 'success');
                
                // Auto-proceed after 2 seconds
                setTimeout(() => goToStep(4), 2000);
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="color: var(--danger);">
                        <i class="fas fa-times-circle"></i> –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ${error.message}
                    </div>
                `;
                showToast(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check if setup is already completed
            checkSetupStatus();
        });

        async function checkSetupStatus() {
            try {
                const settingsRef = ref(db, 'settings/system');
                const snapshot = await get(settingsRef);
                
                if (snapshot.exists() && snapshot.val().setup_completed) {
                    document.getElementById('setup-steps').innerHTML = `
                        <div style="text-align: center; padding: 3rem;">
                            <div style="width: 80px; height: 80px; background: var(--warning); color: white; 
                                 border-radius: 50%; display: flex; align-items: center; justify-content: center; 
                                 font-size: 2rem; margin: 0 auto 2rem;">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <h2>–°–∏—Å—Ç–µ–º–∞ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞</h2>
                            <p style="margin: 1rem 0 2rem;">
                                –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —É–∂–µ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä–∞–Ω–µ–µ.
                            </p>
                            <div class="form-actions" style="justify-content: center;">
                                <button class="btn btn-primary" onclick="location.href='/index.html'">
                                    <i class="fas fa-home"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                                </button>
                                <button class="btn btn-secondary" onclick="location.href='/admin.html'">
                                    <i class="fas fa-cog"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                                </button>
                            </div>
                        </div>
                    `;
                    updateProgress(100);
                }
            } catch (error) {
                // Continue with setup if error (likely no settings yet)
                console.log('Starting fresh setup...');
            }
        }
    </script>

    <style>
        .setup-step {
            padding: 2rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 2rem;
            background: var(--surface);
        }
        
        .setup-step.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .setup-step h3 {
            margin-bottom: 1.5rem;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setup-step h3 i {
            color: var(--primary);
        }
        
        .step-message {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .setup-progress {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }
    </style>
</body>
</html>